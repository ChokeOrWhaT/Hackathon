<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <style>
        :root {
            --brand: #E6F0FA;
            --card: #ffffff;
            --muted: #6c757d
        }

        html,
        body {
            height: 100%;
        }

        body {
            background-color: #f2f0ed !important;
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            color: #222;
        }


        .popup-overlay {
            position: fixed;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.55);
            z-index: 999;
            padding: 2rem;
        }

        .popup-card {
            width: 100%;
            max-width: 820px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            background: #fff;
            display: grid;
            grid-template-columns: 1fr 1fr;
            min-height: 320px;
        }

        .popup-media {
            background-image: url('https://images.unsplash.com/photo-1502810190503-8300270a1b0f?q=80&w=1400&auto=format&fit=crop&ixlib=rb-4.0.3&s=');
            background-size: cover;
            background-position: center;
            min-height: 320px;
        }

        .popup-content {
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            justify-content: center;
        }

        .popup-content h2 {
            margin: 0;
            font-size: 1.6rem;
        }

        .popup-content p {
            margin: 0;
            color: var(--muted);
        }



        .stat-card {
            border-radius: 12px;
            background: var(--card);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
            padding: 1rem;
        }

        .stat-value {
            font-weight: 700;
            font-size: 1.35rem;
        }

        .stat-label {
            color: var(--muted);
            font-size: 0.9rem;
        }


        .card-chart {
            padding: 1rem;
            border-radius: 12px;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.95));
            box-shadow: 0 8px 24px rgba(12, 38, 80, 0.05);
            height: 96%;
        }


        .news-card {
            border-radius: 10px;
            overflow: hidden;
        }

        .news-item {
            border-bottom: 1px solid #eee;
            padding: 0.8rem;
        }



        .news-card {
            max-width: 1140px;
            margin: 40px auto;
        }

        .news-time {
            font-size: 0.85rem;
            color: gray;
            white-space: nowrap;
        }


        .stat-card {
            background: white;
            border-radius: 10px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .news-swiper {
            max-width: 1140px;
            margin: auto;
            overflow: hidden;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .swiper-track {
            display: flex;
            transition: transform 0.6s ease-in-out;
        }

        .swiper-slide {
            flex: 0 0 100%;
            display: flex;
            background: white;
            align-items: center;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }

        .swiper-slide img {
            width: 50%;
            height: 250px;
            object-fit: cover;
            border-top-left-radius: 12px;
            border-bottom-left-radius: 12px;
        }

        .slide-content {
            padding: 20px;
            flex: 1;
        }

        .slide-content h4 {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .slide-content p {
            color: #555;
            margin-bottom: 15px;
        }

        .slide-content small {
            color: #888;
        }

        .bg-grey {
            background-color: black !important;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: 250px;
            background-color: black;
            color: #fff;
            padding-top: 0;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            z-index: 1050;
        }

        .sidebar.active {
            transform: translateX(0);
        }


        .sidebar-header {
            padding: 15px 20px;
            background-color: #1E272C;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header img {
            max-height: 40px;
        }


        .sidebar a {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
            color: #cfd8dc;
            text-decoration: none;
            font-size: 14px;
            border-left: 3px solid transparent;
            transition: background 0.3s, border-color 0.3s;
        }

        .sidebar a:hover {
            background-color: #37474F;
            border-left: 3px solid #29B6F6;
            color: #ff7a18 !important;
        }

        .sidebar a i {
            margin-right: 10px;
            font-size: 16px;
            color: #90a4ae;
        }

        .badge {
            background-color: #29B6F6;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }


        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            background: rgba(0, 0, 0, 0.4);
            display: none;
            z-index: 1040;
        }

        .overlay.active {
            display: block;
        }

        body {
            background-color: #f6f8fb !important;
        }

        .card {
            background: #fff;
            border-radius: 20px;
        }

        .input-group-text {
            border-right: none;
        }

        .form-control {
            border-left: none;
        }

        .form-control:focus {
            box-shadow: none;
            border-color: #86b7fe;
        }

        .card {
            max-width: 100% !important;
            /* allow full width */
            width: 100% !important;
        }

        .card {
            width: 90%;
            /* wider than default */
            margin: 0 auto;
            /* keep it centered */
        }

        #familyReportsSection .card {
            width: 100%;
            /* make it span wider */
            max-width: 1400px;
            /* adjust max size */
            margin: 0 auto;
            /* keep centered */
            padding: 2rem;
            /* more breathing room inside */
        }

        #familyReportsSection .table {
            font-size: 0.95rem;
            /* slightly compact for more data */
        }

        #familyReportsSection .table-responsive {
            max-height: 500px;
            /* scroll vertically if too tall */
            overflow-y: auto;
        }

        .custom-blue {
            color: #1F4E79;
        }

        .bg-custom-blue {
            background-color: #1F4E79;
            color: #fff;
        }

        .btn:hover {
            background-color: #ff7a18 !important;
            color: #fff !important;
        }

        .input-group {
            border-color: black;
        }

        @keyframes slideUpFade {
            0% {
                transform: translateY(50px);
                opacity: 0;
            }

            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .card {
            animation: slideUpFade 0.6s ease-out forwards;
        }

        .footer a {
            color: #d7e6f7;
            text-decoration: none;
        }

        .footer a:hover {
            color: #ffffff;
            text-decoration: underline;
        }

        .footer {
            background-color: black;
            /* Same as navbar */
            color: #ffffff;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .footer h5 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            font-weight: 600;
            color: #ff7a18;
            /* slightly lighter than white */
        }

        .footer p {
            color: #ccc;
            /* softer grey for readability */
            margin-bottom: 0.5rem;
        }

        .footer a {
            color: #00adb5;
            /* accent link color */
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer a:hover {
            color: #e63946;
            /* red highlight on hover */
            text-decoration: underline;
        }

        /* Quick Links list */
        .footer ul {
            padding: 0;
            list-style: none;
        }

        .footer ul li {
            margin-bottom: 0.4rem;
        }

        /* Social Icons */
        .footer .social-icons a {
            font-size: 1.3rem;
            color: #ccc;
            transition: color 0.3s ease, transform 0.3s ease;
        }

        .footer .social-icons a:hover {
            color: #e63946;
            /* brand red */
            transform: translateY(-2px);
        }

        /* Bottom note */
        .footer small {
            color: #ff7a18 !important;
            font-size: 0.85rem;
        }

        .custom-navbar {
            background-color: #1E272C;
            /* Dark gray */
            border-bottom: 1px solid #333;
            padding: 0.8rem 1.5rem;
        }

        /* Dashboard title */
        .dashboard-title {
            font-size: 1.25rem;
            color: #ffffff;
            /* white for contrast */
        }

        /* Dashboard icon (sidebar toggle) */

        .toggle-btn i {
            color: #ffffff;
            /* visible by default */
            font-size: 1.5rem;
            transition: color 0.3s ease;
        }

        .toggle-btn i:hover {
            color: #00ADB5;
            /* teal on hover */
        }

        /* DisasterX branding in the center */
        .brand-name {
            font-size: 1.8rem;
            font-weight: 700;
            color: #ffffff;
            display: inline-block;
            position: relative;
            text-align: center;
            letter-spacing: 1px;
        }

        .brand-highlight {
            color: #e63946;
            /* highlight the 'X' */
        }

        /* Force branding into exact center */
        .navbar .mx-auto {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Live Monitoring text */
        .live-text {
            font-size: 0.9rem;
            font-weight: 500;
            color: #ccc !important;
            /* lighter grey for visibility */
        }

        /* Rectangular Buttons */
        .custom-btn,
        .custom-btn-outline {
            padding: 0.5rem 1.2rem;
            border-radius: 6px;
            /* rectangular with slight rounding */
            font-size: 0.95rem;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        /* Solid signup button */
        .custom-btn {
            background-color: #1F4E79;
            color: #fff !important;
            border: 2px solid #1F4E79;
        }

        .custom-btn:hover {
            background-color: #163a5a;
            border-color: #163a5a;
        }

        /* Outline login button */
        .custom-btn-outline {
            background-color: transparent;
            color: #fff !important;
            /* <-- login text is white now */
            border: 2px solid #1F4E79;
        }

        .custom-btn-outline:hover {
            background-color: #1F4E79;
            color: #fff !important;
        }

        /* Dashboard icon styling */
        .toggle-btn i {
            color: #ffffff;
            /* visible by default */
            font-size: 1.5rem;
            transition: color 0.3s ease;
        }

        .toggle-btn:hover i {
            color: #000000;
            /* on hover = DisasterX red */
        }

        .text-muted {
            color: #fff !important;
        }



        /* Responsive popup -> stack on small screens */
        @media (max-width: 768px) {
            .popup-card {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="your_logo.png" alt="">
        </div>
        <a href="People.html"><i class="bi bi-map"></i>Missing person report</a>
        <a href="crisis.html"><i class="bi bi-cloud-sun"></i>Admin profile</a>
        
    </div>
    <div class="overlay" id="overlay"></div>

    <!--navbar-->
    <nav class="navbar navbar-expand-lg navbar-light bg-grey py-3">
        <div class="container">
            <!-- Sidebar toggle icon -->
            <button class="btn toggle-btn me-2" id="toggleSidebar" aria-label="Toggle sidebar" aria-controls="sidebar"
                aria-expanded="false">
                <i class="bi bi-list fs-4"></i>
            </button>
            <span id="welcomeText" class="ms-2 fw-semibold text-white"></span>
            <div class="mx-auto text-center">
                <span class="brand-name">Disaster<span class="" style="color:#ff7a18">X</span></span>
            </div>
            <div class="ms-auto d-flex gap-2 align-items-center" id="authArea">
                <small class="text-muted me-3">Live · Monitoring</small>
            </div>

        </div>
    </nav>
    <main class="container my-4">

        <!-- Quick stats (8) -->
        <!-- Family Reunification Reports -->
        <section id="familyReportsSection" class="mb-4">
            <div class="card shadow p-4">
                <h3 class="mb-3 text-primary">Family Reunification Reports</h3>
                <div class="table-responsive">
                    <table class="table table-bordered table-hover align-middle">
                        <thead class="table-dark">
                            <tr>
                                <th>Reporter</th>
                                <th>Phone</th>
                                <th>Lost Person</th>
                                <th>Age</th>
                                <th>Gender</th>
                                <th>Location</th>
                                <th>Status</th>
                                <th>Blood Group</th>
                                <th>Photo</th>
                                <th>Reported At</th>
                            </tr>
                        </thead>
                        <tbody id="reportsTableBody">
                            <tr>
                                <td colspan="10" class="text-center">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="charts" class="mb-4">
            <div class="row g-4">
                <div class="col-lg-8">
                    <div class="card-chart p-3 h-100">
                        <h5>Incidents over time</h5>
                        <canvas id="incidentsChart" height="160"></canvas>
                    </div>
                </div>
                <div class="col-lg-4">
                    <h6>Successful vs Rescue operations</h6>
                    <canvas id="successChart" height="180"></canvas>
                </div>
            </div>
        </section>

        <!-- Real-time news -->
        <div class="news-swiper">
            <div class="swiper-track">
                <!-- Slide 1 -->
                <a href="https://example.com/floods" target="_blank" class="swiper-slide">
                    <img src="https://via.placeholder.com/450x250?text=Floods" alt="Floods">
                    <div class="slide-content">
                        <h4>Floods in Riverine District — rescue ongoing</h4>
                        <p>Teams are evacuating affected areas.</p>
                        <small>8/10/2025, 11:10:46 PM</small>
                    </div>
                </a>
                <!-- Slide 2 -->
                <a href="https://example.com/earthquake" target="_blank" class="swiper-slide">
                    <img src="https://via.placeholder.com/450x250?text=Earthquake" alt="Earthquake">
                    <div class="slide-content">
                        <h4>Earthquake tremors reported in coastal belt</h4>
                        <p>Aftershocks continue; monitoring in progress.</p>
                        <small>8/10/2025, 10:10:46 PM</small>
                    </div>
                </a>
                <!-- Slide 3 -->
                <a href="https://example.com/medical" target="_blank" class="swiper-slide">
                    <img src="https://via.placeholder.com/450x250?text=Medical+Aid" alt="Medical Camps">
                    <div class="slide-content">
                        <h4>Temporary medical camps set up</h4>
                        <p>Local NGOs assisting.</p>
                        <small>8/10/2025, 9:10:46 PM</small>
                    </div>
                </a>
            </div>
        </div>

    </main>

    <footer class="footer py-5 mt-auto">
        <div class="container">
            <div class="row g-4">
                <div class="col-md-4">
                    <h5>About DisasterX</h5>
                    <p>DisasterX is a real-time disaster management dashboard that empowers communities, responders, and
                        authorities with live updates, analytics, and resource tracking during emergencies.</p>
                </div>
                <div class="col-md-2">
                    <h5>Quick Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="#">Admin profile</a></li>
                        <li><a href="#">Missing People Report</a></li>
                    
                    </ul>
                </div>
                <div class="col-md-3">
                    <h5>Contact Us</h5>
                    <p>Email: support@disasterx.org</p>
                    <p>Phone: +1 (800) 123-4567</p>
                    <p>Location: Innovation Hub, India</p>
                </div>
                <div class="col-md-3">
                    <h5>Follow Us</h5>
                    <div class="social-icons d-flex gap-3">
                        <a href="#"><i class="bi bi-facebook"></i></a>
                        <a href="#"><i class="bi bi-twitter-x"></i></a>
                        <a href="#"><i class="bi bi-instagram"></i></a>
                        <a href="#"><i class="bi bi-linkedin"></i></a>
                    </div>
                </div>
            </div>
            <div class="text-center mt-4">
                <small class="text-muted">&copy; 2025 DisasterX. All rights reserved.</small>
            </div>
        </div>
    </footer>

    <!--script-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="./public-announcement/backend/auth.js" defer></script>

    <script>

        document.addEventListener('DOMContentLoaded', () => {
            // --- Safe call to protectPage (won't throw if auth.js missing) ---
            if (typeof protectPage === 'function') {
                try { protectPage(); }
                catch (err) { console.error('protectPage() threw:', err); }
            } else {
                console.warn('protectPage() not found — auth.js missing or failed to load.');
            }

            // --- Sidebar toggle setup ---
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            const toggleBtn = document.getElementById('toggleSidebar');

            if (!sidebar || !overlay || !toggleBtn) {
                console.warn('Sidebar init aborted — missing DOM elements:', { sidebar: !!sidebar, overlay: !!overlay, toggleBtn: !!toggleBtn });
                return;
            }

            // Prevent double-initialization if script runs multiple times
            if (toggleBtn.dataset.sidebarInit === 'true') {
                console.log('Sidebar already initialized.');
                return;
            }
            toggleBtn.dataset.sidebarInit = 'true';

            // Helper open/close
            function openSidebar() {
                sidebar.classList.add('active');
                overlay.classList.add('active');
                toggleBtn.setAttribute('aria-expanded', 'true');
                document.body.style.overflow = 'hidden'; // lock background scroll
            }
            function closeSidebar() {
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
                toggleBtn.setAttribute('aria-expanded', 'false');
                document.body.style.overflow = '';
            }

            // Attach handlers
            toggleBtn.addEventListener('click', () => {
                if (sidebar.classList.contains('active')) closeSidebar();
                else openSidebar();
            });

            overlay.addEventListener('click', closeSidebar);

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && sidebar.classList.contains('active')) closeSidebar();
            });

            console.log('Sidebar toggle initialized.');
        });
        // Animated counters
        const counters = document.querySelectorAll('.stat-value');
        const counterObserver = new IntersectionObserver((entries, obs) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const el = entry.target; animateCounter(el); obs.unobserve(el);
                }
            });
        }, { threshold: 0.6 });

        counters.forEach(c => counterObserver.observe(c));

        function animateCounter(el) {
            const target = +el.getAttribute('data-target');
            const duration = 1200;
            let start = null;
            function step(ts) {
                if (!start) start = ts;
                const progress = Math.min((ts - start) / duration, 1);
                el.textContent = Math.floor(progress * target).toLocaleString();
                if (progress < 1) requestAnimationFrame(step);
                else el.textContent = target.toLocaleString();
            }
            requestAnimationFrame(step);
        }

        // Charts
        const incidentsCtx = document.getElementById('incidentsChart').getContext('2d');
        const successCtx = document.getElementById('successChart').getContext('2d');

        const hours = Array.from({ length: 12 }).map((_, i) => `${i + 1}h`);
        const incidentsData = Array.from({ length: 12 }).map(() => Math.floor(Math.random() * 30) + 5);

        const incidentsChart = new Chart(incidentsCtx, {
            type: 'line',
            data: {
                labels: hours,
                datasets: [{
                    label: 'Active incidents',
                    data: incidentsData,
                    fill: true,
                    tension: 0.3,
                    borderWidth: 2,
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: true } },
                scales: { y: { beginAtZero: true } }
            }
        });

        const successChart = new Chart(successCtx, {
            type: 'doughnut',
            data: {
                labels: ['Successful', 'Pending/Failed'],
                datasets: [{ data: [72, 28], hoverOffset: 6 }]
            },
            options: { responsive: true }
        });

        // Real-time updates
        function simulateRealtimeUpdate() {
            document.querySelectorAll('.stat-value').forEach(el => {
                const base = +el.getAttribute('data-target');
                const jitter = Math.floor((Math.random() - 0.4) * Math.max(1, base * 0.05));
                const newVal = Math.max(0, base + jitter);
                el.setAttribute('data-target', newVal);
                el.textContent = newVal.toLocaleString();
            });

            const newPoint = Math.floor(Math.random() * 35) + 2;
            incidentsChart.data.labels.push((+incidentsChart.data.labels.slice(-1)[0].replace('h', '') + 1) + 'h');
            incidentsChart.data.datasets[0].data.push(newPoint);
            if (incidentsChart.data.labels.length > 24) { incidentsChart.data.labels.shift(); incidentsChart.data.datasets[0].data.shift(); }
            incidentsChart.update();

            const succ = Math.max(0, Math.min(100, successChart.data.datasets[0].data[0] + Math.floor((Math.random() - 0.5) * 6)));
            successChart.data.datasets[0].data[0] = succ;
            successChart.data.datasets[0].data[1] = 100 - succ;
            successChart.update();
        }

        setInterval(simulateRealtimeUpdate, 8000);

        // News fetching

        window.addEventListener('load', () => {
            document.querySelectorAll('.stat-value').forEach(el => {
                if (el.textContent === '0') animateCounter(el);
            });
        });

        let index = 0;
        const slides = document.querySelectorAll('.swiper-slide');
        const track = document.querySelector('.swiper-track');
        const total = slides.length;

        function nextSlide() {
            index++;
            if (index >= total) {
                index = 0; // loop back
            }
            track.style.transform = `translateX(-${index * 100}%)`;
        }

        setInterval(nextSlide, 3000); // slide every 3s

    </script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDyL2xbz6shEdgd93w9LLu-xjiEilDONIA",
            authDomain: "family-identification-tool.firebaseapp.com",
            projectId: "family-identification-tool",
            storageBucket: "family-identification-tool.appspot.com",
            messagingSenderId: "482977845070",
            appId: "1:482977845070:web:5f5c66b3327a662cabd81f",
            measurementId: "G-0K62CJ74JV"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function loadReports() {
            const reportsTableBody = document.getElementById("reportsTableBody");
            reportsTableBody.innerHTML = "<tr><td colspan='10' class='text-center'>Loading...</td></tr>";

            const q = query(collection(db, "familyReports"), orderBy("createdAt", "desc"));
            const snapshot = await getDocs(q);

            if (snapshot.empty) {
                reportsTableBody.innerHTML = "<tr><td colspan='10' class='text-center'>No reports found</td></tr>";
                return;
            }

            reportsTableBody.innerHTML = "";

            snapshot.forEach(doc => {
                const data = doc.data();
                const date = data.createdAt?.toDate().toLocaleString() || "N/A";

                reportsTableBody.innerHTML += `
        <tr>
          <td>${data.reporterName || "-"}</td>
          <td>${data.reporterPhone || "-"}</td>
          <td>${data.name || "-"}</td>
          <td>${data.age || "-"}</td>
          <td>${data.gender || "-"}</td>
          <td>${data.lastSeen || "-"}</td>
          <td><span class="badge bg-${data.status === "Missing" ? "danger" : data.status === "Found" ? "success" : "warning"}">${data.status}</span></td>
          <td>${data.bloodGroup || "-"}</td>
          <td>${data.photoUrl ? `<img src="${data.photoUrl}" alt="photo" width="50" class="rounded">` : "No Photo"}</td>
          <td>${date}</td>
        </tr>
      `;
            });
        }

        loadReports();
    </script>




</body>

</html>